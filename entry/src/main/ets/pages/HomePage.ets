import router from '@ohos.router';
import common from '@ohos.app.ability.common';
import { OrderListPage } from './OrderListPage';
import { ProfilePage } from './ProfilePage';

interface RouterParams {
  tableId?: string;
}

@Component
struct OrderList {
  build() {
    Column() {
      Text('æˆ‘çš„è®¢å•')
        .fontSize(24)
        .fontWeight(FontWeight.Bold)
        .margin({ top: 20, bottom: 20 })

      // è®¢å•åˆ—è¡¨ï¼ˆå ä½ï¼‰
      Column() {
        Text('æš‚æ— è®¢å•')
          .fontSize(16)
          .fontColor('#999999')
      }
      .width('100%')
      .layoutWeight(1)
      .justifyContent(FlexAlign.Center)
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#F5F5F5')
    .padding(20)
  }
}

@Component
struct Profile {
  build() {
    Column() {
      Text('ä¸ªäººä¸­å¿ƒ')
        .fontSize(24)
        .fontWeight(FontWeight.Bold)
        .margin({ top: 20, bottom: 20 })

      // ä¸ªäººä¿¡æ¯ï¼ˆå ä½ï¼‰
      Column() {
        Text('æœªç™»å½•')
          .fontSize(16)
          .fontColor('#999999')
      }
      .width('100%')
      .layoutWeight(1)
      .justifyContent(FlexAlign.Center)
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#F5F5F5')
    .padding(20)
  }
}

@Entry
@Component
struct HomePage {
  @State currentIndex: number = 0;
  @State tableId: string = '';
  @State recommendedDishes: Array<DishItem> = [
    { id: 1, name: 'ç‰¹è‰²çº¢çƒ§è‚‰', price: 48.00, description: 'ç²¾é€‰äº”èŠ±è‚‰ï¼Œä¼ ç»Ÿå·¥è‰º', image: $r('app.media.background'), tag: 'æ‹›ç‰Œ' },
    { id: 2, name: 'æ¸…ç‚’æ—¶è”¬', price: 22.00, description: 'æ–°é²œåº”å­£è”¬èœ', image: $r('app.media.background'), tag: 'ç‰¹æƒ ' },
    { id: 3, name: 'éº»å©†è±†è…', price: 32.00, description: 'å·å‘³åè¶³ï¼Œå£æ„Ÿç»†è…»', image: $r('app.media.background'), tag: 'æ¨è' },
  ];

  @State categories: Array<CategoryItem> = [
    { id: 1, name: 'çƒ­èœ', icon: 'ğŸ”¥' },
    { id: 2, name: 'å‡‰èœ', icon: 'â„ï¸' },
    { id: 3, name: 'ä¸»é£Ÿ', icon: 'ğŸš' },
    { id: 4, name: 'æ±¤ç±»', icon: 'ğŸ¥£' },
    { id: 5, name: 'é¥®å“', icon: 'ğŸ¥¤' }
  ];

  @State menuItems: Array<DishItem> = [
    { id: 1, name: 'å®«ä¿é¸¡ä¸', price: 38.00, description: 'å£æ„Ÿé²œè¾£ï¼Œæ­é…èŠ±ç”Ÿ', image: $r('app.media.background'), category: 'çƒ­èœ' },
    { id: 2, name: 'æ°´ç…®é±¼ç‰‡', price: 58.00, description: 'æ–°é²œè‰é±¼ï¼Œéº»è¾£é²œé¦™', image: $r('app.media.background'), category: 'çƒ­èœ' },
    { id: 3, name: 'å‡‰æ‹Œé»„ç“œ', price: 18.00, description: 'çˆ½å£å¼€èƒƒ', image: $r('app.media.background'), category: 'å‡‰èœ' },
    { id: 4, name: 'è’œè“‰ç²‰ä¸', price: 28.00, description: 'è’œé¦™å››æº¢', image: $r('app.media.background'), category: 'çƒ­èœ' },
  ];

  @Builder TabBuilder(title: string, index: number, normalIcon: Resource) {
    Column() {
      Image(normalIcon)
        .width(24)
        .height(24)
        .margin({ bottom: 4 })
        .fillColor(this.currentIndex === index ? '#F36D6F' : '#999999')
      Text(title)
        .fontSize(12)
        .fontColor(this.currentIndex === index ? '#F36D6F' : '#999999')
    }
  }

  @Builder HomeContent() {
    Column() {
      // é¡¶éƒ¨æ 
      Row() {
        Text('æ™ºæ…§é¤å…').fontSize(24).fontWeight(FontWeight.Bold)
        if (this.tableId) {
          Text('æ¡Œå·ï¼š' + this.tableId)
            .fontSize(16)
            .margin({ left: 10 })
        }
        Blank()
        Button('æ‰«ç ç‚¹é¤')
          .backgroundColor('#F36D6F')
          .onClick(() => router.pushUrl({ url: 'pages/ScanPage' }))
      }
      .width('100%')
      .padding({ left: 20, right: 20, top: 15, bottom: 15 })
      .backgroundColor(Color.White)

      // æ¨èèœå“åˆ—è¡¨
      Text('æ¨èèœå“')
        .fontSize(20)
        .fontWeight(FontWeight.Bold)
        .margin({ top: 20, bottom: 15 })
        .padding({ left: 20 })

      ForEach([1, 2, 3], (item: number) => {
        Row() {
          Column() {
            Text('èœå“ ' + item)
              .fontSize(18)
              .margin({ bottom: 5 })
            Text('Â¥ ' + (item * 10).toString() + '.00')
              .fontSize(16)
              .fontColor('#F36D6F')
          }.alignItems(HorizontalAlign.Start)
          .layoutWeight(1)

          Button('è¯¦æƒ…')
            .onClick(() => router.pushUrl({ url: 'pages/DishDetailPage' }))
            .backgroundColor('#F36D6F')
            .margin({ left: 10 })
        }
        .width('100%')
        .padding(15)
        .backgroundColor(Color.White)
        .borderRadius(8)
        .margin({ bottom: 10 })
      })
    }
    .width('100%')
    .height('100%')
    .padding({ left: 20, right: 20, bottom: 20 })
  }

  @Builder MenuPage() {
    Column() {
      // é¡¶éƒ¨å¯¼èˆªæ 
      Row() {
        Image($r('app.media.startIcon'))
          .width(32)
          .height(32)
          .margin({ right: 8 })
        Text('æ™ºæ…§é¤å…')
          .fontSize(20)
          .fontWeight(FontWeight.Bold)
        Blank()
        Button() {
          Image($r('app.media.scan'))
            .width(24)
            .height(24)
        }
        .backgroundColor(Color.Transparent)
        .margin({ right: 8 })
        Button('æ‰«ç ç‚¹é¤', { type: ButtonType.Capsule })
          .backgroundColor('#FF6B6B')
          .height(32)
      }
      .width('100%')
      .padding(15)
      .backgroundColor('#FFFFFF')

      Scroll() {
        Column() {
          // æ¨èèœå“æ¨ªå‘æ»šåŠ¨
          Text('æ¨èèœå“')
            .fontSize(18)
            .fontWeight(FontWeight.Bold)
            .margin({ top: 16, bottom: 12, left: 15 })
          
          List({ space: 12, scroller: new Scroller() }) {
            ForEach(this.recommendedDishes, (item: DishItem) => {
              ListItem() {
                Column() {
                  Stack() {
                    Image(item.image)
                      .width('100%')
                      .height(160)
                      .borderRadius(8)
                      .objectFit(ImageFit.Cover)
                    Text(item.tag)
                      .fontSize(12)
                      .backgroundColor('#FF6B6B')
                      .fontColor(Color.White)
                      .padding({ left: 8, right: 8, top: 4, bottom: 4 })
                      .borderRadius({ topLeft: 8, bottomRight: 8 })
                      .position({ x: 0, y: 0 })
                  }
                  Text(item.name)
                    .fontSize(16)
                    .fontWeight(FontWeight.Medium)
                    .margin({ top: 8, bottom: 4 })
                  Text(item.description)
                    .fontSize(14)
                    .fontColor('#666666')
                    .margin({ bottom: 4 })
                  Text(`ï¿¥${item.price.toFixed(2)}`)
                    .fontSize(16)
                    .fontColor('#FF6B6B')
                }
                .width(280)
                .backgroundColor(Color.White)
                .borderRadius(12)
                .padding(12)
              }
            })
          }
          .width('100%')
          .height(240)
          .listDirection(Axis.Horizontal)
          .margin({ left: 15 })

          // åˆ†ç±»æ ‡ç­¾æ¨ªå‘æ»šåŠ¨
          Row() {
            ForEach(this.categories, (item: CategoryItem) => {
              Column() {
                Text(item.icon)
                  .fontSize(28)
                  .margin({ bottom: 8 })
                Text(item.name)
                  .fontSize(14)
                  .fontColor('#333333')
              }
              .width(64)
              .alignItems(HorizontalAlign.Center)
              .margin({ left: item.id === 1 ? 12 : 0, right: 12 })
            })
          }
          .width('100%')
          .height(90)
          .margin({ top: 20, bottom: 20 })
          .justifyContent(FlexAlign.SpaceEvenly)
          .backgroundColor(Color.White)

          // èœå“ç½‘æ ¼
          Grid() {
            ForEach(this.menuItems, (item: DishItem) => {
              GridItem() {
                Column() {
                  Image(item.image)
                    .width('100%')
                    .height(120)
                    .borderRadius(8)
                    .objectFit(ImageFit.Cover)
                  Text(item.name)
                    .fontSize(16)
                    .fontWeight(FontWeight.Medium)
                    .margin({ top: 8, bottom: 4 })
                  Text(item.description)
                    .fontSize(14)
                    .fontColor('#666666')
                    .margin({ bottom: 4 })
                  Row() {
                    Text(`ï¿¥${item.price.toFixed(2)}`)
                      .fontSize(16)
                      .fontColor('#FF6B6B')
                    Blank()
                    Button({ type: ButtonType.Circle, stateEffect: true }) {
                      Text('+')
                        .fontSize(20)
                        .fontWeight(FontWeight.Bold)
                        .fontColor('#FFFFFF')
                    }
                    .width(24)
                    .height(24)
                    .backgroundColor('#FF6B6B')
                  }
                  .width('100%')
                  .alignItems(VerticalAlign.Center)
                }
                .backgroundColor(Color.White)
                .borderRadius(12)
                .padding(12)
              }
            })
          }
          .width('100%')
          .height('100%')
          .columnsTemplate('1fr 1fr')
          .columnsGap(12)
          .rowsGap(12)
          .margin({ top: 16, left: 15, right: 15 })
        }
      }
      .layoutWeight(1)
      .scrollBar(BarState.Off)
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#F5F5F5')
  }

  @Builder OrderListBuilder() {
    OrderListPage()
  }

  @Builder ProfileBuilder() {
    ProfilePage()
  }

  aboutToAppear() {
    try {
      const params = router.getParams() as RouterParams;
      this.tableId = params?.tableId || '';
    } catch (error) {
      console.error('Failed to get router params:', error instanceof Error ? error.message : 'Unknown error');
    }
  }

  build() {
    Column() {
      if (this.currentIndex === 0) {
        this.MenuPage()
      } else if (this.currentIndex === 1) {
        this.OrderListBuilder()
      } else {
        this.ProfileBuilder()
      }

      // åº•éƒ¨å¯¼èˆªæ 
      Row() {
        Column() {
          Image($r('app.media.scan'))
            .width(24)
            .height(24)
            .fillColor(this.currentIndex === 0 ? '#FF6B6B' : '#999999')
          Text('æ‰«ç ç‚¹é¤')
            .fontSize(12)
            .fontColor(this.currentIndex === 0 ? '#FF6B6B' : '#999999')
            .margin({ top: 4 })
        }
        .onClick(() => this.currentIndex = 0)
        .layoutWeight(1)
        .justifyContent(FlexAlign.Center)

        Column() {
          Image($r('app.media.order'))
            .width(24)
            .height(24)
            .fillColor(this.currentIndex === 1 ? '#FF6B6B' : '#999999')
          Text('æˆ‘çš„è®¢å•')
            .fontSize(12)
            .fontColor(this.currentIndex === 1 ? '#FF6B6B' : '#999999')
            .margin({ top: 4 })
        }
        .onClick(() => this.currentIndex = 1)
        .layoutWeight(1)
        .justifyContent(FlexAlign.Center)

        Column() {
          Image($r('app.media.profile'))
            .width(24)
            .height(24)
            .fillColor(this.currentIndex === 2 ? '#FF6B6B' : '#999999')
          Text('ä¸ªäººä¸­å¿ƒ')
            .fontSize(12)
            .fontColor(this.currentIndex === 2 ? '#FF6B6B' : '#999999')
            .margin({ top: 4 })
        }
        .onClick(() => this.currentIndex = 2)
        .layoutWeight(1)
        .justifyContent(FlexAlign.Center)
      }
      .width('100%')
      .height(56)
      .backgroundColor(Color.White)
      .position({ x: 0, y: '100%' })
      .translate({ y: -56 })
      .borderColor('#E3E3E3')
      .borderWidth({ top: 0.5 })
    }
    .width('100%')
    .height('100%')
  }
}

interface DishItem {
  id: number;
  name: string;
  price: number;
  description: string;
  image: Resource;
  tag?: string;
  category?: string;
}

interface CategoryItem {
  id: number;
  name: string;
  icon: string;
} 